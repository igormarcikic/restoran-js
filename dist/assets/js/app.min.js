let leviMeni=document.querySelector(".left-menu"),desniMeni=document.querySelector(".right-menu"),allIncrement=document.querySelectorAll(".increment"),allDecrement=document.querySelectorAll(".decrement"),currentOrder=[],tables=document.querySelector("main"),count=document.querySelectorAll(".count"),orderFromDb=document.querySelector(".order-from-db"),db=firestore.collection("restoran"),stolovi=document.querySelectorAll(".table");function Food(e){this.name=e.options.name,this.price=this.price()}function Topping(e){this.name=e.options.name,this.price=this.price()}function Drink(e){this.name=e.options.name,this.volume=e.options.volume,this.price=this.price()}[...stolovi].forEach((e,t)=>{e.addEventListener("click",(function(){let e=t+1;localStorage.setItem("brojStola",e),db.doc(`table-${e}`).get().then(e=>{let t=e.data();t.order?(desniMeni.classList.add("show"),tables.classList.add("disable"),displayOrderInfo(t)):(leviMeni.classList.add("show"),tables.classList.add("disable"))})}))}),fetchImages=()=>new Promise((e,t)=>{const r=new XMLHttpRequest;r.addEventListener("readystatechange",()=>{if(4===r.readyState&&200===r.status){const t=JSON.parse(r.responseText);e(t),updateUI(t)}else 4===r.readyState&&t()}),r.open("GET","https://api.myjson.com/bins/b8l8p"),r.send()}),updateUI=e=>{let t=document.querySelector(".pizza .card img"),r=document.querySelector(".pasta .card img"),n=document.querySelector(".prilozi .card img"),o=document.querySelector(".pice .card img");t.setAttribute("src",e.pizzaUrl),r.setAttribute("src",e.pastaUrl),n.setAttribute("src",e.prilogUrl),o.setAttribute("src",e.piceUrl)},increment=()=>{let e=event.target.nextElementSibling.innerHTML;e++,event.target.nextElementSibling.innerHTML=e},decrement=()=>{let e=event.target.previousElementSibling.innerHTML;e>0&&e--,event.target.previousElementSibling.innerHTML=e},allIncrement.forEach(e=>{e.addEventListener("click",()=>{increment()})}),allDecrement.forEach(e=>{e.addEventListener("click",()=>{decrement()})}),Food.prototype.price=function(){return Math.floor(300*Math.random()+300)},Topping.prototype.price=function(){return Math.floor(80*Math.random()+20)},Drink.prototype.price=function(){return Math.floor(350*Math.random()+150)};let FactoryDish=function(){};FactoryDish.prototype.create=function(e){let t;switch(e.options.tip){case"pizza":case"pasta":t=new Food(e);break;case"topping":t=new Topping(e);break;case"drink":t=new Drink(e)}return t},addToOrder=e=>{currentOrder.push((new FactoryDish).create({options:e}))},removeFromOrder=e=>{currentIndex=currentOrder.findIndex(t=>e==t.name),currentOrder.splice(currentIndex,1)},newOrder=()=>{if(currentOrder.length>0){let e=localStorage.getItem("brojStola");db.doc(`table-${e}`).set({order:JSON.stringify(currentOrder)},{merge:!0}),alert("Vasa porudbina je zabelezena"),currentOrder=[],leviMeni.classList.remove("show"),tables.classList.remove("disable"),resetAll()}else alert("Morate izabrati makar jedan proizvod")},abandonOrder=()=>{currentOrder=[],leviMeni.classList.remove("show"),desniMeni.classList.remove("show"),tables.classList.remove("disable"),resetAll()},displayOrderInfo=e=>{let t=JSON.parse(e.order),r=t.map(e=>e.price).reduce((e,t)=>e+t),n=`<h4>Porudzbina Stola broj ${e.id}:</h4><ul>`;t.forEach(e=>{n+=`<li>Naziv: <strong>${e.name}</strong></li><ul><li>Cena: <strong>${e.price}din</strong></li></ul>`}),n+=`</li></ul>\n    <hr>\n    <h4>Ukupna cena: ${r}din</h4\n    `,orderFromDb.innerHTML=n},pay=()=>{let e=localStorage.getItem("brojStola");db.doc(`table-${e}`).update({order:firebase.firestore.FieldValue.delete()}),alert("Vasa porudbina je placena"),currentOrder=[],desniMeni.classList.remove("show"),tables.classList.remove("disable")},resetAll=()=>{count.forEach(e=>{e.innerHTML=0})},fetchImages();